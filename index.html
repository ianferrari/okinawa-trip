<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¥å¥å…¨å®¶æ²–ç¹©éŠ ğŸ¦•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700;900&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #0f172a; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        
        /* æ¯›ç»ç’ƒèˆ‡è³ªæ„Ÿ */
        .glass { background: rgba(255, 255, 255, 0.92); backdrop-filter: blur(20px); -webkit-backdrop-filter: blur(20px); border-top: 1px solid rgba(255, 255, 255, 0.5); }
        .glass-dark { background: rgba(0, 0, 0, 0.5); backdrop-filter: blur(12px); -webkit-backdrop-filter: blur(12px); border: 1px solid rgba(255, 255, 255, 0.15); color: white; }
        .glass-card { background: rgba(255, 255, 255, 0.95); box-shadow: 0 8px 32px rgba(0,0,0,0.1); border: 1px solid rgba(255, 255, 255, 0.6); }

        /* å‹•ç•«ç‰¹æ•ˆ */
        @keyframes slideUp { from { opacity: 0; transform: translateY(30px); } to { opacity: 1; transform: translateY(0); } }
        .animate-slide-up { animation: slideUp 0.5s cubic-bezier(0.16, 1, 0.3, 1) forwards; }
        
        @keyframes pop { 0% { transform: scale(1); } 50% { transform: scale(1.1); } 100% { transform: scale(1); } }
        .animate-pop { animation: pop 0.3s ease-in-out; }

        .tab-active { background: #2563eb; color: white; box-shadow: 0 4px 15px rgba(37, 99, 235, 0.4); transform: scale(1.05); }
        .tab-inactive { background: rgba(255, 255, 255, 0.15); color: rgba(255, 255, 255, 0.9); border: 1px solid rgba(255,255,255,0.1); }
        
        /* Checkbox & Progress */
        .custom-checkbox:checked + div { background-color: #2563eb; border-color: #2563eb; }
        
        /* Toast Notification */
        #toast { visibility: hidden; min-width: 250px; margin-left: -125px; background-color: rgba(30, 41, 59, 0.9); color: #fff; text-align: center; border-radius: 50px; padding: 16px; position: fixed; z-index: 100; left: 50%; bottom: 100px; font-size: 14px; backdrop-filter: blur(5px); box-shadow: 0 10px 30px rgba(0,0,0,0.3); opacity: 0; transition: opacity 0.3s, bottom 0.3s; }
        #toast.show { visibility: visible; opacity: 1; bottom: 110px; }

        /* Calculator Specific */
        #jpyInput, #twdOutput, #rateInput { font-weight: 900; }
        /* ç§»é™¤ rateInput çš„é è¨­é‚Šæ¡†ï¼Œè®“å®ƒçœ‹èµ·ä¾†åƒæ–‡å­— */
        #rateInput { border-bottom: 2px dashed #ca8a04; color: #ca8a04; width: 100px; text-align: center; }
    </style>
</head>
<body class="h-screen flex flex-col text-gray-800 overflow-hidden relative">

    <div id="bg-layer" class="absolute inset-0 z-0 bg-cover bg-center transition-all duration-700 transform scale-105" 
         style="background-image: url('https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=1000&fit=crop');">
        <div class="absolute inset-0 bg-gradient-to-b from-black/70 via-black/20 to-slate-100/90"></div>
    </div>

    <div class="z-10 pt-safe-top px-5 pb-2 flex-shrink-0">
        <div class="flex justify-between items-start pt-12 mb-4 text-white">
            <div>
                <div class="flex items-center gap-2 mb-2">
                    <span class="bg-blue-600 px-2 py-0.5 rounded-md text-[10px] font-bold tracking-wider uppercase shadow-lg border border-blue-400/30">2026 TRIP</span>
                    <div id="countdown" class="text-[10px] font-mono font-medium opacity-90 bg-black/40 px-2 py-0.5 rounded-md backdrop-blur-sm border border-white/10">è¨ˆç®—ä¸­...</div>
                </div>
                <h1 class="text-3xl font-black tracking-tight drop-shadow-lg leading-tight">å¥å¥å…¨å®¶<br>æ²–ç¹©éŠ ğŸ¦•</h1>
                <p class="text-sm opacity-95 font-medium mt-2 text-blue-100 drop-shadow-md"><i class="fas fa-calendar-alt mr-1"></i>3/28 (å…­) - 4/3 (äº”)</p>
            </div>
            
            <div class="glass-dark px-4 py-3 rounded-2xl text-center shadow-lg min-w-[80px] active:scale-95 transition-transform" onclick="initWeather()">
                <i id="weather-icon" class="fas fa-spinner fa-spin text-xl mb-1 block text-yellow-400"></i>
                <span id="weather-temp" class="text-sm font-bold">å®šä½ä¸­</span>
                <div id="weather-loc" class="text-[9px] opacity-70 mt-0.5">é»æ“Šé‡æ•´</div>
            </div>
        </div>

        <div id="sub-nav-container" class="mt-2"></div>
    </div>

    <div id="main-scroll" class="flex-1 overflow-y-auto p-4 pb-32 z-10 scroll-smooth rounded-t-[2.5rem] bg-slate-50 shadow-[0_-10px_40px_rgba(0,0,0,0.15)] relative top-2">
        </div>

    <div class="fixed bottom-0 w-full glass flex justify-around items-center pb-safe-bottom h-[90px] z-50 rounded-t-[2rem] shadow-[0_-5px_20px_rgba(0,0,0,0.05)]">
        <button onclick="switchTab('itinerary')" class="nav-btn flex flex-col items-center justify-center w-full h-full group" id="btn-itinerary">
            <div class="icon-box p-2 rounded-2xl mb-1 transition-all duration-300 group-active:scale-90"><i class="fas fa-map-location-dot text-xl text-blue-600"></i></div>
            <span class="text-[10px] font-bold text-blue-600">è¡Œç¨‹</span>
        </button>
        <button onclick="switchTab('checklist')" class="nav-btn flex flex-col items-center justify-center w-full h-full group" id="btn-checklist">
            <div class="icon-box p-2 rounded-2xl mb-1 transition-all duration-300 group-active:scale-90"><i class="fas fa-clipboard-list text-xl text-gray-400"></i></div>
            <span class="text-[10px] font-bold text-gray-400">æ¸…å–®</span>
        </button>
        <button onclick="switchTab('missions')" class="nav-btn flex flex-col items-center justify-center w-full h-full group" id="btn-missions">
            <div class="icon-box p-2 rounded-2xl mb-1 transition-all duration-300 group-active:scale-90"><i class="fas fa-medal text-xl text-gray-400"></i></div>
            <span class="text-[10px] font-bold text-gray-400">æˆå°±</span>
        </button>
        <button onclick="switchTab('tools')" class="nav-btn flex flex-col items-center justify-center w-full h-full group" id="btn-tools">
            <div class="icon-box p-2 rounded-2xl mb-1 transition-all duration-300 group-active:scale-90"><i class="fas fa-toolbox text-xl text-gray-400"></i></div>
            <span class="text-[10px] font-bold text-gray-400">å·¥å…·</span>
        </button>
    </div>

    <div id="toast"><i class="fas fa-check-circle mr-2 text-green-400"></i><span id="toast-msg">å·²è¤‡è£½</span></div>

<script>
    // ================= DATA (è³‡æ–™åº«) =================
    
    // è®€å–ã€Œå„²å­˜çš„åŒ¯ç‡ã€ï¼Œå¦‚æœæ²’æœ‰å°±ç”¨é è¨­å€¼ 0.21
    let savedRate = localStorage.getItem('user_rate');
    let CURRENT_RATE = savedRate ? parseFloat(savedRate) : 0.21;

    const bgImages = {
        D1: "https://images.unsplash.com/photo-1436491865332-7a61a109cc05?q=80&w=1000&fit=crop",
        D2: "https://images.unsplash.com/photo-1582967788606-a171f1080ca8?q=80&w=1000&fit=crop",
        D3: "https://images.unsplash.com/photo-1560275619-4662e36fa65c?q=80&w=1000&fit=crop",
        D4: "https://images.unsplash.com/photo-1518709766631-a6a7f45921c3?q=80&w=1000&fit=crop",
        D5: "https://images.unsplash.com/photo-1534234828569-2f2249520468?q=80&w=1000&fit=crop",
        D6: "https://images.unsplash.com/photo-1570533412033-662309e3df4e?q=80&w=1000&fit=crop",
        D7: "https://images.unsplash.com/photo-1542051841857-5f90071e7989?q=80&w=1000&fit=crop",
        SHOP: "https://images.unsplash.com/photo-1472851294608-415522f96319?q=80&w=1000&fit=crop",
        TOOL: "https://images.unsplash.com/photo-1484417894907-623942c8ee29?q=80&w=1000&fit=crop",
        MISSION: "https://images.unsplash.com/photo-1533227297464-9429738d1964?q=80&w=1000&fit=crop",
        CALC: "https://images.unsplash.com/photo-1563986768603-41fef5d00369?q=80&w=1000&fit=crop"
    };

    // è¡Œç¨‹è³‡æ–™ (å« MapCode)
    const itineraryDB = [
        { day: "D1", date: "3/28 (å…­)", title: "å•Ÿç¨‹ & é©æ‡‰", highlights: "æ©Ÿå ´è²·å¥¶ / OTSå–è»Š / ä½åè­·", bg: bgImages.D1, events: [
            { time: "13:15", title: "æ˜Ÿå®‡ JX302 èµ·é£›", icon: "fa-plane-departure", note: "çµ¦å¥å¥åƒè»Ÿç³–å¹³è¡¡è€³å£“", map: "å°ä¸­åœ‹éš›æ©Ÿå ´" },
            { time: "15:45", title: "æŠµé”é‚£éœ¸æ©Ÿå ´", icon: "fa-plane-arrival", note: "1F Lawson è²·é®®å¥¶/æˆé•·å¥¶", map: "" },
            { time: "16:30", title: "æ­æ¥é§è»Šå¾€ OTS", icon: "fa-bus", note: "1F å¤§å»³å¤–æ‰¾ OTS æ——å¹Ÿ (10-Aæœˆå°)", map: "" },
            { time: "17:00", title: "OTS è‡¨ç©ºè±å´ å–è»Š", icon: "fa-car", note: "æª¢æŸ¥è»Šæ³ã€è£æ±½åº§ã€‚å°èˆªè¨­é£¯åº—", map: "OTS è‡¨ç©ºè±å´ç‡Ÿæ¥­æ‰€" },
            { time: "18:00", title: "é«˜é€Ÿå…¬è·¯åŒ—ä¸Š", icon: "fa-road", note: "ä¸­é€”åœï¼šä¸­åŸPAæˆ–ä¼ŠèŠ¸SA &è¨˜å¾—è²·æ°´ ", map: "" },
            { time: "19:30", title: "é£¯åº— Check-in", icon: "fa-hotel", note: "Best Western Kouki Beach", map: "Best Western Okinawa Kouki Beach", mapcode: "206 473 354*11" },
            { time: "20:00", title: "æ™šé¤ï¼šåè­·åœ¨åœ°", icon: "fa-utensils", note: "ç¾æ‹‰èŠ±åˆ¥é‚¸ / å“¥å€«å¸ƒç‰›æ’ / å…¨å®¶", map: "Restaurant Columbin" }
        ]},
        { day: "D2", date: "3/29 (æ—¥)", title: "ç»ç’ƒèˆ¹ & è£œçµ¦", highlights: "æµ·ä¸­å…¬åœ’ / AEON æƒè²¨ / ç©æ²™", bg: bgImages.D2, events: [
            { time: "09:30", title: "éƒ¨ç€¨åæµ·ä¸­å…¬åœ’", icon: "fa-water", note: "æ­ç»ç’ƒåº•èˆ¹æ‰¾å°¼è« ğŸ ", map: "éƒ¨ç€¨åæµ·ä¸­å…¬åœ’", mapcode: "206 442 077*71" },
            { time: "12:00", title: "åˆé¤ï¼šHama å£½å¸", icon: "fa-bowl-rice", note: "åè­·åº—ï¼Œå¹³åƒ¹è¿´è½‰å£½å¸", map: "HAMAå£½å¸ åè­·åº—" },
            { time: "13:30", title: "AEON åè­·åº—", icon: "fa-cart-shopping", note: "å¤§å‰µè²·ç©æ²™çµ„ã€è¶…å¸‚è²·æ°´", map: "AEON åè­·åº—", mapcode: "206 626 669*52" },
            { time: "15:00", title: "è¨±ç”°ä¼‘æ¯ç«™", icon: "fa-ticket", note: "è²·æ°´æ—é¤¨å„ªæƒ ç¥¨ (åªæ”¶ç¾é‡‘)", map: "é“ã®é§… è¨±ç”°" },
            { time: "16:00", title: "é£¯åº—æ²™ç˜ç©æ²™", icon: "fa-umbrella-beach", note: "æ‹¿å‡ºå¤§å‰µè²·çš„ç©å…·", map: "" },
            { time: "18:00", title: "æ™šé¤ï¼šç¾æ‹‰èŠ±åˆ¥é‚¸", icon: "fa-utensils", note: "èµ°è·¯å»åƒï¼Œæ¦»æ¦»ç±³åŒ…å»‚", map: "ç¾æ‹‰èŠ±" }
        ]},
        { day: "D3", date: "3/30 (ä¸€)", title: "ç¾éº—æµ· & å¤å®‡åˆ©", highlights: "é¯¨é¯Š / è·¨æµ·å¤§æ©‹ / è¦è¦é£¯", bg: bgImages.D3, events: [
            { time: "09:30", title: "ç¾éº—æµ·æ°´æ—é¤¨", icon: "fa-fish", note: "åœ P7 ç«‹é«”åœè»Šå ´æœ€å¿«ï¼Œç›´è¡é»‘æ½®ä¹‹æµ·", map: "æµ·æ´‹åšå…¬åœ’P7ç«‹é«”åœè»Šå ´", mapcode: "553 075 797*77" },
            { time: "13:30", title: "å‰å¾€å¤å®‡åˆ©å³¶", icon: "fa-car-side", note: "è»Šä¸Šè®“å¥å¥åˆç¡", map: "" },
            { time: "14:30", title: "å¤å®‡åˆ©æµ·æ´‹å¡”", icon: "fa-tower-observation", note: "æ­ç„¡äººé³³æ¢¨è»Š", map: "å¤å®‡åˆ©æµ·æ´‹å¡”" },
            { time: "16:00", title: "é»å¿ƒï¼šè¦è¦é£¯", icon: "fa-shrimp", note: "Kouri Shrimp (æ©‹æ—)", map: "Kouri Shrimp" },
            { time: "16:30", title: "æ©‹ä¸‹æ²™ç˜", icon: "fa-camera", note: "æ‹å…¨å®¶ç¦", map: "å¤å®‡åˆ©æµ·ç˜" },
            { time: "18:00", title: "æ™šé¤ï¼šåè­·ä¸ƒé¸ä¸€", icon: "fa-fire-burner", note: "å¤§å®¶ / ç‡’è‚‰ä¹ƒæˆ‘é‚£éœ¸ / è—å£½å¸", map: "ç‡’è‚‰ä¹ƒæˆ‘é‚£éœ¸ æ–°é¤¨" }
        ]},
        { day: "D4", date: "3/31 (äºŒ)", title: "æé¾ & å…¬åœ’", highlights: "DINO Park / ç”œç”œåœˆ / æºœæ»‘æ¢¯", bg: bgImages.D4, events: [
            { time: "10:00", title: "DINO æé¾ PARK", icon: "fa-dragon", note: "âš ï¸ çˆ¸çˆ¸è«‹ç”¨æ¹å·¾ï¼Œæ‰¾80éš»æé¾", map: "DINOæé¾PARK å±±åŸäºç†±å¸¶ä¹‹æ£®", mapcode: "206 745 056*82" },
            { time: "11:30", title: "åˆé¤ï¼šå¾¡è“å­å¾¡æ®¿", icon: "fa-bowl-food", note: "å°±åœ¨æé¾å…¬åœ’æ¨“ä¸Š", map: "" },
            { time: "13:00", title: "å³¶è±†è…ç”œç”œåœˆ", icon: "fa-cookie-bite", note: "Shima Donuts (è³£å®Œåƒ A&W)", map: "Shima Donuts" },
            { time: "15:00", title: "21ä¸–ç´€ä¹‹æ£®å…¬åœ’", icon: "fa-child-reaching", note: "çœ‹é»‘è‰²ç«è»Šé ­ã€é•·æºœæ»‘æ¢¯", map: "21ä¸–ç´€ä¹‹æ£®å…¬åœ’", mapcode: "206 626 779*74" },
            { time: "16:30", title: "Blue Seal å†°æ·‡æ·‹", icon: "fa-ice-cream", note: "åè­·åº—ï¼Œåƒ Kids Size", map: "Blue Seal Nago" }
        ]},
        { day: "D5", date: "4/01 (ä¸‰)", title: "å‹•ç‰© & æ”¾ç©º", highlights: "Neo Park å°ç«è»Š / é£¯åº—æ³³æ± ", bg: bgImages.D5, events: [
            { time: "10:00", title: "Neo Park å‹•æ¤ç‰©åœ’", icon: "fa-crow", note: "é€²é–€å…ˆæ­å¾©å¤å°ç«è»Š", map: "åè­·è‡ªç„¶å‹•æ¤ç‰©å…¬åœ’", mapcode: "206 689 725*11" },
            { time: "12:30", title: "åˆé¤ï¼šCookhal", icon: "fa-leaf", note: "æˆ–åƒ å¹¸é†¬æ²–ç¹©éºµ (æ¦»æ¦»ç±³)", map: "Cookhal" },
            { time: "15:30", title: "é£¯åº—æ³³æ± /æ²™ç˜", icon: "fa-person-swimming", note: "å¤§äººæ”¾ç©ºï¼Œå°å­©å¾¹åº•æ”¾é›»", map: "" },
            { time: "18:00", title: "æ™šé¤ï¼šç™¾å¹´å¤å®¶ å¤§å®¶", icon: "fa-house", note: "å¿…åƒé˜¿å¤è±¬ç«é‹ (å·²é ç´„)", map: "ç™¾å¹´å¤å®¶ å¤§å®¶" },
            { time: "20:00", title: "æ‰“åŒ…è¡Œæ", icon: "fa-suitcase", note: "æ˜å¤©è¦é€€æˆ¿å¾€å—äº†", map: "" }
        ]},
        { day: "D6", date: "4/02 (å››)", title: "ç§»å‹• & è³¼ç‰©", highlights: "PARCO CITY / DMM / ä½é‚£éœ¸", bg: bgImages.D6, events: [
            { time: "10:30", title: "é€€æˆ¿å¾€å—", icon: "fa-car", note: "ç›´å¥”æµ¦æ·» (ç´„1å°æ™‚)", map: "" },
            { time: "11:30", title: "PARCO CITY", icon: "fa-bag-shopping", note: "åˆé¤(2F) & è³¼ç‰©", map: "SAN-A æµ¦æ·»è¥¿æµ·å²¸ PARCO CITY", mapcode: "33 339 062*55" },
            { time: "15:00", title: "DMM æ°´æ—é¤¨", icon: "fa-fish-fins", note: "ä½æ–¼ iias å•†å ´ï¼Œçœ‹æ¨¹æ‡¶ã€æ‘¸é­š", map: "DMM Kariyushi Aquarium", mapcode: "232 543 400*25" },
            { time: "17:40", title: "é‚£éœ¸ Check-in", icon: "fa-building", note: "Daiwa Roynet åœ‹éš›é€š (è»Šåœ3F)", map: "Daiwa Roynet Hotel Naha Kokusai-dori" },
            { time: "19:00", title: "æ™šé¤ï¼šéº¥ç•¶å‹", icon: "fa-burger", note: "åœ‹éš›é€šç‰§å¿—åº— (å°å­©çš„æ•‘è´–)", map: "McDonald's Kokusai Dori Makishi" },
            { time: "20:30", title: "Fontana Gelato", icon: "fa-ice-cream", note: "å½©è™¹å†°æ·‡æ·‹", map: "Fontana Gelato" }
        ]},
        { day: "D7", date: "4/03 (äº”)", title: "ç¥ˆé¡˜ & è¿”å®¶", highlights: "æ³¢ä¸Šå®® / Outlet / 13:00é‚„è»Š", bg: bgImages.D7, events: [
            { time: "09:20", title: "æ³¢ä¸Šå®®", icon: "fa-torii-gate", note: "æ‡¸å´–ä¸Šçš„ç¥ç¤¾ï¼Œè²·å¾¡å®ˆ", map: "æ³¢ä¸Šå®®" },
            { time: "11:10", title: "ASHIBINAA Outlet", icon: "fa-shirt", note: "åˆé¤(ç¾é£Ÿè¡—) & æœ€å¾Œè¡åˆº", map: "ASHIBINAA Outlet", mapcode: "232 544 452*22" },
            { time: "12:40", title: "åŠ æ²¹ (OTSæ—)", icon: "fa-gas-pump", note: "ä¿ç•™æ”¶æ“šï¼(ENEOS)", map: "ENEOS Dr.Drive Self Toyosaki SS" },
            { time: "13:00", title: "OTS é‚„è»Š", icon: "fa-car-side", note: "å‹™å¿…æº–æ™‚ã€‚æª¢æŸ¥ ETC å¡æ‹”äº†æ²’", map: "OTS è‡¨ç©ºè±å´ç‡Ÿæ¥­æ‰€" },
            { time: "13:45", title: "æŠµé”æ©Ÿå ´", icon: "fa-plane-departure", note: "é€›å…ç¨…åº— (è²·é•·é ¸é¹¿è–¯æ¢)", map: "é‚£éœ¸æ©Ÿå ´" },
            { time: "16:45", title: "æ˜Ÿå®‡ JX303 èµ·é£›", icon: "fa-paper-plane", note: "å›å®¶å›‰ï¼", map: "" }
        ]}
    ];

    // æ¸…å–®è³‡æ–™
    const checklistDB = [
        { id: "pack", title: "ğŸ’ è¡Œå‰æ‰“åŒ… (å®Œæ•´)", items: [
            { text: "è­·ç…§ (å…¨å®¶3æœ¬)", sub: "æ•ˆæœŸéœ€ > 2026/10" },
            { text: "é§•ç…§æ­£æœ¬ + æ—¥æ–‡è­¯æœ¬", sub: "OTS å–è»Šå¿…å‚™" },
            { text: "Visit Japan Web æˆªåœ–", sub: "å­˜æ‰‹æ©Ÿç›¸ç°¿" },
            { text: "ä½å®¿æ†‘è­‰/é›»è©±", sub: "ç¬¬ä¸€æ™š Check-in ç”¨" },
            { text: "å¥å¥å®‰æ’«åŒ…", sub: "è²¼ç´™æ›¸ã€è»Ÿç³–ã€è–„å¤–å¥—" },
            { text: "è»Šå…§ç™¾å¯¶è¢‹", sub: "é®é™½ç°¾ã€è»Šå……ã€åƒåœ¾è¢‹" },
            { text: "3C é›»å­", sub: "è¡Œå‹•é›»æº(éš¨èº«)ã€å……é›»æŠ•ã€ç·šã€ç›¸æ©Ÿç›¸é—œ" },
            { text: "ç”Ÿæ´»å‚™è—¥", sub: "é€€ç‡’è—¥ã€ç›Šç”ŸèŒã€é«”æº«è¨ˆã€é¼»å™´åŠ‘" },
            { text: "é˜²æ›¬/ç©æ°´", sub: "æ³³è¡£ã€é˜²æ›¬ä¹³ã€å¸½å­ã€å¢¨é¡" },
            { text: "é£Ÿç‰©å‰ªåˆ€ (æ‰˜é‹)", sub: "çµ•å°ä¸å¯æ”¾éš¨èº«" }
        ]},
        { id: "shop", title: "ğŸ›ï¸ è³¼ç‰©å¿…è²· (å®Œæ•´)", items: [
            { text: "åˆåˆ©ä»–å‘½ EX Plus", sub: "å®¶åº­å¸¸å‚™è—¥" },
            { text: "è‹¥å…ƒéŒ  (Wakamoto)", sub: "é¡§è…¸èƒƒ" },
            { text: "EVE æ­¢ç—›è—¥", sub: "è—è‰²/ç™½è‰²" },
            { text: "Kowa èšŠèŸ²æ­¢ç™¢æ¶²", sub: "åˆ·é ­ç‰ˆ (çµ¦å¥å¥ç”¨)" },
            { text: "å¤§å‰µ - å„ç¨®æ³¡æ¾¡çƒ", sub: "AEON åè­·åº—å¿…è²·" },
            { text: "å¤§å‰µ - æŒ–æ²™å·¥å…·çµ„", sub: "æµ·é‚Šç©æ²™ç”¨" },
            { text: "LuLuLun é¢è†œ", sub: "æ²–ç¹©é™å®š (è‹¦ç“œ/é¦™æª¸)" },
            { text: "å®‰è€æ›¬é˜²æ›¬", sub: "é‡‘ç“¶ (æ²–ç¹©å¤ªé™½æ¯’)" },
            { text: "Tomica æ²–ç¹©é™å®šè»Š", sub: "PARCO / æ©Ÿå ´" },
            { text: "è¾£å‘³è¦é¤… (å—é¢¨å ‚)", sub: "ä¸‹é…’é›¶é£Ÿ" },
            { text: "é‚ŠéŠ€é£Ÿå ‚è¾£æ²¹", sub: "çŸ³å£å³¶åç”¢" }
        ]},
        { id: "return", title: "ğŸš¨ å›ç¨‹é˜²å‘† (SOP)", items: [
            { text: "ETC å¡æ‹”äº†å—ï¼Ÿ", sub: "é‚„è»Šå‰ç¢ºèª (æœ€å¸¸å¿˜è¨˜)" },
            { text: "è»Šå……é ­æ‹”äº†å—ï¼Ÿ", sub: "é‚„è»Šå‰ç¢ºèª" },
            { text: "é–€é‚Šåƒåœ¾/ç©å…·æ¸…ç©ºï¼Ÿ", sub: "é‚„è»Šå‰ç¢ºèª" },
            { text: "æ²¹åŠ æ»¿äº†å—ï¼Ÿ", sub: "ä¿ç•™æ”¶æ“šçµ¦åº—å“¡" },
            { text: "å¸ƒä¸/æœå‡ æ‰˜é‹äº†å—ï¼Ÿ", sub: "æ¶²é«” > 100ml ä¸å¯æ‰‹æ" },
            { text: "æ´—é¢ä¹³/ç‰™è† æ‰˜é‹äº†å—ï¼Ÿ", sub: "é€™ä¹Ÿæ˜¯æ¶²é«”ï¼" },
            { text: "è­·ç…§æ‹¿å‡ºä¾†äº†å—ï¼Ÿ", sub: "ä¸è¦é–åœ¨é£¯åº—ä¿éšªç®±" },
            { text: "Wifiæ©Ÿ/SIMå¡é‡", sub: "ç¢ºèªæ”¶å¥½" }
        ] }
    ];

    // æˆå°±è³‡æ–™
    const missionsDB = [
        { id: "m1", title: "æˆ‘æ˜¯èˆ¹é•·", desc: "åœ¨ç»ç’ƒèˆ¹æ‰¾åˆ°å°¼è«", icon: "fa-fish" },
        { id: "m2", title: "æµ·æ´‹éœ¸ä¸»", desc: "è·Ÿå¤§é¯¨é¯Šæ‹åˆç…§", icon: "fa-camera" },
        { id: "m3", title: "å°å°å‹‡è€…", desc: "æ£®æ—æ¢éšªæ‹¯æ•‘å—å‚·çš„æé¾", icon: "fa-dragon" },
        { id: "m4", title: "é³¥é³¥é»å", desc: "æ­å°ç«è»Šæ•¸å‡º3ç¨®é³¥", icon: "fa-crow" },
        { id: "m5", title: "æµ·åº•å°‹å¯¶", desc: "åœ¨é€æ˜åœ°æ¿æ‰¾åˆ°é­š", icon: "fa-water" },
        { id: "m6", title: "èª å¿ƒç¥ˆç¦", desc: "åœ¨ç¥ç¤¾æŠ•ç¡¬å¹£èªªè¬è¬", icon: "fa-hands-praying" }
    ];

    // å·¥å…·è³‡æ–™ (drive, jp, sos)
    const toolsDB = {
        drive: [
            { title: "å³é§•å£è¨£", content: "å·¦è½‰å°å½ã€å³è½‰å¤§å½<br>é›¨åˆ·åœ¨å·¦ã€æ–¹å‘ç‡ˆåœ¨å³", color: "bg-blue-50 text-blue-800" },
            { title: "åŠ æ²¹é‡‘å¥", content: "Regular æ»¿æ²¹ (ç´…æ§)<br>ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼æº€ã‚¿ãƒ³<br>(Regyuraa mantan)", color: "bg-orange-50 text-orange-800" },
            { title: "å°èˆªè¨­å®š", content: "åœè»Šè«‹æ‰¾ ğŸ…¿ï¸ (P)<br>è¼¸å…¥ MapCode æœ€æº–", color: "bg-slate-100 text-slate-800" },
            { title: "é‡è¦æ¨™èªŒ", content: "ğŸ”» æ­¢ã¾ã‚Œ (åœ)ï¼šå®Œå…¨ç…åœ<br>â›” é€²å…¥ç¦æ­¢ï¼šä¸å¯é€²å…¥<br>â¬‡ï¸ å¾è¡Œï¼šæ¸›é€Ÿæ…¢è¡Œ", color: "bg-red-50 text-red-700" }
        ],
        jp: [
            { label: "é¤å»³ç”¨é¤", items: [
                { t: "ä¸è¦åŠ å†°å¡Š", j: "æ°·ãªã—ã§ãŠé¡˜ã„ã—ã¾ã™", p: "Koori nashi de" },
                { t: "æœ‰å…’ç«¥æ¤…å—?", j: "å­ä¾›ç”¨ã®æ¤…å­ã¯ã‚ã‚Šã¾ã™ã‹?", p: "Kodomo-yo no isu..." },
                { t: "çµ¦å…’ç«¥é¤å…·", j: "å­ä¾›ç”¨ã®å–ã‚Šçš¿ã¨ã‚¹ãƒ—ãƒ¼ãƒ³", p: "Torizara to supuun" },
                { t: "æˆ‘è¦å¤–å¸¶", j: "æŒã¡å¸°ã‚Šã«ã§ãã¾ã™ã‹", p: "Mochi-kaeri ni..." },
                { t: "æˆ‘è¦çµå¸³", j: "ãŠä¼šè¨ˆã‚’ãŠé¡˜ã„ã—ã¾ã™", p: "Okaikei o onegai" }
            ]},
            { label: "ä¾¿åˆ©å•†åº— & é£¯åº—", items: [
                { t: "è«‹å¹«æˆ‘å¾®æ³¢", j: "æ¸©ã‚ã¦ãã ã•ã„", p: "Atata-mete kudasai" },
                { t: "æˆ‘è¦è¾¦ç†å…¥ä½", j: "ãƒã‚§ãƒƒã‚¯ã‚¤ãƒ³ã‚’ãŠé¡˜ã„ã—ã¾ã™", p: "Check-in o onegai" },
                { t: "å¯ä»¥å¯„æ”¾è¡Œæå—", j: "è·ç‰©ã‚’é ã‹ã£ã¦ã‚‚ã‚‰ãˆã¾ã™ã‹", p: "Nimotsu o azukatte..." }
            ]},
            { label: "è³¼ç‰©é€€ç¨…", items: [
                { t: "æˆ‘è¦æ‰¾é€™å€‹(æŒ‡åœ–)", j: "ã“ã‚Œã¨åŒã˜ã‚‚ã®ã‚’æ¢ã—ã¦ã„ã¾ã™", p: "Kore to onaji mono..." },
                { t: "æˆ‘è¦é€€ç¨…", j: "å…ç¨ã‚’ãŠé¡˜ã„ã—ã¾ã™", p: "Menzei o onegai..." },
                { t: "ä¸è¦å°èµ·ä¾†(é¦¬ä¸Šç”¨)", j: "è¢‹ã«å…¥ã‚Œãªã„ã§ãã ã•ã„", p: "Fukuro ni irenaide" }
            ]},
            { label: "ç·Šæ€¥ç‹€æ³", items: [
                { t: "å°å­©ç™¼ç‡’äº†", j: "å­ä¾›ãŒç†±ã‚’å‡ºã—ã¾ã—ãŸ", p: "Kodomo ga netsu o..." },
                { t: "è«‹å«æ•‘è­·è»Š", j: "æ•‘æ€¥è»Šã‚’å‘¼ã‚“ã§ãã ã•ã„", p: "Kyukyu-sha o yonde" },
                { t: "è«‹å¹«æˆ‘å ±è­¦", j: "è­¦å¯Ÿã‚’å‘¼ã‚“ã§ãã ã•ã„", p: "Keisatsu o yonde" }
            ]}
        ],
        sos: [
            { name: "æ•‘è­·è»Š / ç«è­¦", tel: "119", style: "bg-red-500 text-white" },
            { name: "å ±è­¦ (è»Šç¦)", tel: "110", style: "bg-blue-600 text-white" },
            { name: "OTS ç§Ÿè»Šæ•‘æ´", tel: "098-856-8877", style: "bg-green-600 text-white" },
            { name: "å¤–äº¤éƒ¨æ€¥é›£æ•‘åŠ©", tel: "080-8056-0122", style: "bg-gray-700 text-white" },
            { name: "åè­·åŒ—éƒ¨é†«é™¢", tel: "0980-52-2719", style: "bg-white border text-gray-800" },
            { name: "é‚£éœ¸å—éƒ¨é†«ç™‚", tel: "098-888-0123", style: "bg-white border text-gray-800" }
        ]
    };

    // ================= LOGIC =================
    let activeTab = 'itinerary';
    let currentDayIdx = 0;
    let currentChecklistFilter = 'pack';
    let currentToolFilter = 'drive';

    // å¤©æ°£èˆ‡GPS
    function initWeather() {
        const weatherIcon = document.getElementById('weather-icon');
        const weatherTemp = document.getElementById('weather-temp');
        const weatherLoc = document.getElementById('weather-loc');

        weatherTemp.innerText = "å®šä½ä¸­...";
        weatherIcon.className = "fas fa-spinner fa-spin text-xl mb-1 block text-yellow-400";

        if (navigator.geolocation) {
            navigator.geolocation.getCurrentPosition(
                (position) => {
                    const lat = position.coords.latitude;
                    const lon = position.coords.longitude;
                    fetchWeather(lat, lon, "ç›®å‰ä½ç½®");
                },
                (error) => {
                    console.log("GPS Error", error);
                    fetchWeather(26.5915, 127.9773, "åè­·å¸‚");
                }
            );
        } else {
            fetchWeather(26.5915, 127.9773, "åè­·å¸‚");
        }
    }

    async function fetchWeather(lat, lon, label) {
        try {
            const res = await fetch(`https://api.open-meteo.com/v1/forecast?latitude=${lat}&longitude=${lon}&current_weather=true`);
            const data = await res.json();
            const temp = Math.round(data.current_weather.temperature);
            const code = data.current_weather.weathercode;
            
            document.getElementById('weather-temp').innerText = temp + "Â°C";
            document.getElementById('weather-loc').innerText = label;
            
            const iconEl = document.getElementById('weather-icon');
            if (code <= 1) iconEl.className = "fas fa-sun text-xl mb-1 block text-yellow-400";
            else if (code <= 3) iconEl.className = "fas fa-cloud-sun text-xl mb-1 block text-yellow-400";
            else if (code <= 65) iconEl.className = "fas fa-cloud-rain text-xl mb-1 block text-blue-300";
            else iconEl.className = "fas fa-bolt text-xl mb-1 block text-yellow-500";
            
        } catch (e) {
            document.getElementById('weather-temp').innerText = "24Â°C";
            document.getElementById('weather-loc').innerText = "é å ±";
        }
    }

    // å€’æ•¸è¨ˆæ™‚ (2026/3/28)
    function updateCountdown() {
        const tripDate = new Date('2026-03-28T13:15:00').getTime();
        const now = new Date().getTime();
        const diff = tripDate - now;

        if (diff > 0) {
            const days = Math.floor(diff / (1000 * 60 * 60 * 24));
            const hours = Math.floor((diff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
            document.getElementById('countdown').innerText = `é‚„æœ‰ ${days} å¤© ${hours} å°æ™‚`;
        } else {
            document.getElementById('countdown').innerText = "æ—…ç¨‹é€²è¡Œä¸­ï¼";
        }
    }

    function init() {
        switchTab('itinerary', false);
        updateCountdown();
        setInterval(updateCountdown, 60000);
        initWeather();
    }

    window.switchTab = (tab, shouldRender=true) => {
        activeTab = tab;
        document.querySelectorAll('.nav-btn').forEach(btn => {
            const icon = btn.querySelector('i');
            const span = btn.querySelector('span');
            const box = btn.querySelector('.icon-box');
            
            if(btn.id === `btn-${tab}`) {
                icon.className = icon.className.replace('text-gray-400', 'text-blue-600');
                span.className = 'text-[10px] font-bold text-blue-600';
                box.className = 'icon-box p-2 rounded-2xl mb-1 transition-all bg-blue-50';
            } else {
                icon.className = `fas fa-${btn.id.split('-')[1] === 'itinerary' ? 'map-location-dot' : btn.id.split('-')[1] === 'checklist' ? 'clipboard-list' : btn.id.split('-')[1] === 'missions' ? 'medal' : 'toolbox'} text-xl text-gray-400`;
                span.className = 'text-[10px] font-bold text-gray-400';
                box.className = 'icon-box p-2 rounded-2xl mb-1 transition-all';
            }
        });
        
        renderHeaderSubNav();
        if(shouldRender) renderContent();
        // â˜… é—œéµä¿®å¾©ï¼šå»¶é²ä¸€ä¸‹å†æ›´æ–°å­é¸å–®é¡è‰²ï¼Œç¢ºä¿ DOM å·²ç¶“å­˜åœ¨
        setTimeout(updateSubNavStyle, 50);
    }

    function renderHeaderSubNav() {
        const container = document.getElementById('sub-nav-container');
        
        // 1. è¡Œç¨‹é 
        if (activeTab === 'itinerary') {
            container.innerHTML = `
                <div class="flex overflow-x-auto gap-3 pb-2 hide-scrollbar px-2">
                    ${itineraryDB.map((d, i) => `
                        <button onclick="currentDayIdx=${i}; renderContent(); updateHeaderActive()" 
                            class="day-btn flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold backdrop-blur-md transition-all duration-300 ${i === currentDayIdx ? 'tab-active' : 'tab-inactive'}">
                            <div class="text-[10px] opacity-80 uppercase">${d.day}</div>
                            <div>${d.date.split(' ')[0]}</div>
                        </button>
                    `).join('')}
                </div>`;
            document.getElementById('bg-layer').style.backgroundImage = `url('${itineraryDB[currentDayIdx].bg}')`;
        
        // 2. æ¸…å–®é  (ä½¿ç”¨ ID èˆ‡ switchChecklist)
        } else if (activeTab === 'checklist') {
            container.innerHTML = `
                <div class="flex glass-dark p-1 rounded-2xl mx-1">
                    ${checklistDB.map(c => `
                        <button id="btn-chk-${c.id}" onclick="switchChecklist('${c.id}')" 
                            class="flex-1 py-2 rounded-xl text-xs font-bold transition-all ${currentChecklistFilter === c.id ? 'bg-white text-blue-600 shadow-sm' : 'text-white/80'}">
                            ${c.title.split(' ')[1]}
                        </button>
                    `).join('')}
                </div>`;
            document.getElementById('bg-layer').style.backgroundImage = `url('${bgImages.SHOP}')`;
        
        // 3. å·¥å…·é  (ä½¿ç”¨ ID èˆ‡ switchTool)
        } else if (activeTab === 'tools') {
            container.innerHTML = `
                <div class="flex glass-dark p-1 rounded-2xl mx-1">
                    <button id="btn-tool-calc" onclick="switchTool('calc')" class="flex-1 py-2 rounded-xl text-xs font-bold ${currentToolFilter==='calc'?'bg-white text-yellow-600':'text-white/80'}">ğŸ’° åŒ¯ç‡</button>
                    <button id="btn-tool-drive" onclick="switchTool('drive')" class="flex-1 py-2 rounded-xl text-xs font-bold ${currentToolFilter==='drive'?'bg-white text-blue-600':'text-white/80'}">ğŸš— é§•é§›</button>
                    <button id="btn-tool-jp" onclick="switchTool('jp')" class="flex-1 py-2 rounded-xl text-xs font-bold ${currentToolFilter==='jp'?'bg-white text-blue-600':'text-white/80'}">ğŸ—£ï¸ æ—¥èª</button>
                    <button id="btn-tool-sos" onclick="switchTool('sos')" class="flex-1 py-2 rounded-xl text-xs font-bold ${currentToolFilter==='sos'?'bg-white text-red-600':'text-white/80'}">ğŸš¨ æ€¥é›£</button>
                </div>`;
             document.getElementById('bg-layer').style.backgroundImage = `url('${currentToolFilter === 'calc' ? bgImages.CALC : bgImages.TOOL}')`;
        
        // 4. æˆå°±é 
        } else if (activeTab === 'missions') {
            container.innerHTML = `<div class="text-center text-white/90 text-sm font-bold pt-2">å®Œæˆä»»å‹™å¯ä»¥ç²å¾—é‡‘ç‰Œå–”ï¼</div>`;
            document.getElementById('bg-layer').style.backgroundImage = `url('${bgImages.MISSION}')`;
        }
    }

    function updateHeaderActive() {
        const btns = document.querySelectorAll('.day-btn');
        btns.forEach((btn, i) => {
            btn.className = `day-btn flex-shrink-0 px-4 py-2 rounded-full text-sm font-bold backdrop-blur-md transition-all duration-300 ${i === currentDayIdx ? 'tab-active' : 'tab-inactive'}`;
        });
    }

    function renderContent() {
        const main = document.getElementById('main-scroll');
        
        if (activeTab === 'itinerary') {
            const d = itineraryDB[currentDayIdx];
            main.innerHTML = `
                <div class="animate-slide-up">
                    <div class="glass-card rounded-3xl p-5 mb-6 relative overflow-hidden border-l-4 border-blue-500">
                        <div class="flex items-center gap-2 mb-2">
                             <span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-1 rounded-md">Day ${currentDayIdx + 1}</span>
                             <h2 class="text-xl font-bold text-gray-800">${d.date}</h2>
                        </div>
                        <div class="text-sm font-medium text-gray-500 mb-3">${d.title}</div>
                        <div class="text-sm bg-slate-50 p-3 rounded-xl border border-slate-100 text-gray-600 flex items-start gap-2">
                            <i class="fas fa-star text-yellow-500 mt-0.5"></i> 
                            <span class="font-medium">${d.highlights}</span>
                        </div>
                    </div>
                    
                    <div class="space-y-4">
                        ${d.events.map((e, idx) => `
                            <div class="group bg-white p-4 rounded-2xl shadow-sm border border-slate-100 flex gap-4 relative overflow-hidden transition-transform active:scale-[0.98]">
                                <div class="flex flex-col items-center gap-2 mt-1 min-w-[3rem]">
                                    <div class="w-12 h-12 rounded-2xl bg-gradient-to-br from-blue-50 to-indigo-50 text-blue-600 flex items-center justify-center text-xl shadow-inner border border-white">
                                        <i class="fas ${e.icon}"></i>
                                    </div>
                                    ${idx !== d.events.length - 1 ? '<div class="h-full w-0.5 bg-slate-100 rounded-full"></div>' : ''}
                                </div>
                                <div class="flex-1 py-1">
                                    <div class="flex justify-between items-start mb-1">
                                        <h3 class="font-bold text-gray-800 text-lg">${e.time}</h3>
                                        <div class="flex gap-2">
                                            ${e.mapcode ? `<button onclick="copyMapCode('${e.mapcode}')" class="glass px-2 py-1.5 rounded-full text-[10px] text-slate-600 font-bold border border-slate-200 active:bg-slate-200"><i class="fas fa-hashtag mr-1"></i>MapCode</button>` : ''}
                                            ${e.map ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.map)}" target="_blank" class="glass px-3 py-1.5 rounded-full text-xs text-blue-600 font-bold border border-blue-100"><i class="fas fa-location-arrow mr-1"></i> GO</a>` : ''}
                                        </div>
                                    </div>
                                    <p class="font-bold text-gray-700 mb-2">${e.title}</p>
                                    ${e.note ? `<p class="text-xs text-gray-500 bg-slate-50 p-2 rounded-lg border border-slate-100"><i class="fas fa-info-circle mr-1 text-blue-400"></i>${e.note}</p>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="h-12"></div>
                </div>`;
        } else if (activeTab === 'checklist') {
            const list = checklistDB.find(c => c.id === currentChecklistFilter);
            main.innerHTML = `
                <div class="animate-slide-up glass-card rounded-3xl p-6 min-h-[60vh]">
                    <h3 class="font-bold text-xl mb-6 text-gray-800 border-b pb-4 border-gray-100 flex items-center gap-2">
                        <span class="w-1.5 h-6 bg-blue-500 rounded-full"></span>
                        ${list.title}
                    </h3>
                    <div class="space-y-4">
                        ${list.items.map((item, i) => {
                            const key = `chk_${currentChecklistFilter}_${i}`;
                            const isChecked = localStorage.getItem(key) === '1';
                            return `
                                <label class="flex items-start gap-3 p-3 rounded-2xl transition-all border border-transparent hover:bg-slate-50 cursor-pointer group">
                                    <div class="relative flex items-center mt-0.5">
                                        <input type="checkbox" class="custom-checkbox peer appearance-none w-6 h-6 border-2 border-slate-300 rounded-lg transition-all" 
                                            ${isChecked ? 'checked' : ''} onchange="toggleCheck('${key}')">
                                        <i class="fas fa-check text-white absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2 opacity-0 peer-checked:opacity-100 text-xs pointer-events-none"></i>
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-bold text-gray-700 peer-checked:text-gray-400 peer-checked:line-through transition-colors text-[15px]">${item.text}</div>
                                        ${item.sub ? `<div class="text-xs text-gray-400 mt-0.5">${item.sub}</div>` : ''}
                                    </div>
                                </label>
                            `;
                        }).join('')}
                    </div>
                     <button onclick="resetChecklist('${currentChecklistFilter}')" class="w-full mt-8 py-4 bg-slate-50 rounded-2xl text-xs text-gray-400 font-bold tracking-wide">
                        <i class="fas fa-rotate-right mr-1"></i> é‡ç½®æ¸…å–®
                    </button>
                </div>`;
        } else if (activeTab === 'missions') {
            main.innerHTML = `
                <div class="animate-slide-up grid grid-cols-2 gap-4">
                    ${missionsDB.map(m => {
                        const isDone = localStorage.getItem(m.id) === '1';
                        return `
                        <div onclick="toggleMission('${m.id}')" class="glass-card rounded-3xl p-4 flex flex-col items-center justify-center text-center gap-2 aspect-square relative overflow-hidden transition-all active:scale-95 ${isDone ? 'border-2 border-yellow-400 bg-yellow-50' : 'grayscale opacity-80'}">
                            ${isDone ? '<div class="absolute top-2 right-2 text-yellow-500 text-xl animate-pop"><i class="fas fa-check-circle"></i></div>' : ''}
                            <div class="w-14 h-14 rounded-full ${isDone ? 'bg-yellow-400 text-white' : 'bg-slate-200 text-slate-400'} flex items-center justify-center text-2xl mb-1 shadow-sm transition-colors">
                                <i class="fas ${m.icon}"></i>
                            </div>
                            <div class="font-bold text-slate-800 leading-tight">${m.title}</div>
                            <div class="text-[10px] text-slate-500 leading-tight">${m.desc}</div>
                        </div>`;
                    }).join('')}
                </div>
                <div class="mt-6 text-center">
                    <p class="text-xs text-slate-500">é»æ“Šå¡ç‰‡ä¾†æ”¶é›†å°ç« ï¼</p>
                </div>
            `;
        } else if (activeTab === 'tools') {
            if (currentToolFilter === 'calc') {
                main.innerHTML = `
                    <div class="animate-slide-up space-y-4">
                        <div class="glass-card rounded-3xl p-6 text-center shadow-lg border-2 border-yellow-300">
                            <h3 class="text-xs font-bold text-yellow-600 mb-2 uppercase tracking-wider">åŒ¯ç‡æ›ç®—å™¨ (å¯é»æ“Šä¿®æ”¹)</h3>
                            <div class="text-xl font-bold text-gray-500 mb-4 flex items-center justify-center gap-2">
                                1 JPY = <input type="number" id="rateInput" value="${CURRENT_RATE}" oninput="updateRate(this.value)" class="text-yellow-600 text-3xl font-black bg-transparent focus:outline-none focus:border-b-2 focus:border-yellow-500 transition-colors" step="0.0001"> TWD
                            </div>
                            <p class="text-xs text-gray-400 mb-6"><i class="fas fa-save mr-1"></i>ç³»çµ±æœƒè‡ªå‹•è¨˜ä½æ‚¨è¼¸å…¥çš„åŒ¯ç‡</p>

                            <div class="flex flex-col gap-4">
                                <div class="bg-blue-50 p-4 rounded-xl border border-blue-100">
                                    <label class="block text-sm font-medium text-gray-600 mb-1">æ—¥å¹£ (JPY)</label>
                                    <input type="number" id="jpyInput" oninput="convertCurrency()" placeholder="è¼¸å…¥æ—¥å¹£é‡‘é¡ (Â¥)"
                                        class="w-full text-3xl text-gray-800 bg-transparent focus:outline-none text-center p-2">
                                </div>
                                
                                <i class="fas fa-arrow-down text-3xl text-blue-500 animate-bounce"></i>

                                <div class="bg-green-50 p-4 rounded-xl border border-green-100">
                                    <label class="block text-sm font-medium text-gray-600 mb-1">ç´„ç­‰æ–¼å°å¹£ (TWD)</label>
                                    <div id="twdOutput" class="w-full text-4xl text-green-700 text-center p-2">0</div>
                                </div>
                            </div>
                            
                        </div>
                        <div class="h-12"></div>
                    </div>`;
                setTimeout(() => {
                    const jpyInput = document.getElementById('jpyInput');
                    if (jpyInput) jpyInput.focus();
                }, 100);

            } else if (currentToolFilter === 'drive') {
                main.innerHTML = `
                    <div class="animate-slide-up space-y-4">
                        <div class="grid grid-cols-2 gap-3 mb-6 sm:grid-cols-4">
                            <button onclick="quickSearch('toilets')" class="bg-white p-3 rounded-2xl shadow-sm text-center active:scale-95 transition-transform">
                                <i class="fas fa-restroom text-blue-500 text-xl mb-1 block"></i>
                                <span class="text-xs font-bold">æ‰¾å»æ‰€</span>
                            </button>
                            <button onclick="quickSearch('convenience store')" class="bg-white p-3 rounded-2xl shadow-sm text-center active:scale-95 transition-transform">
                                <i class="fas fa-store text-orange-500 text-xl mb-1 block"></i>
                                <span class="text-xs font-bold">æ‰¾è¶…å•†</span>
                            </button>
                            <button onclick="quickSearch('parking')" class="bg-white p-3 rounded-2xl shadow-sm text-center active:scale-95 transition-transform">
                                <i class="fas fa-square-parking text-slate-600 text-xl mb-1 block"></i>
                                <span class="text-xs font-bold">æ‰¾åœè»Š</span>
                            </button>
                            <button onclick="quickSearch('æ²–ç¹© è¦ªå­å‹å–„é¤å»³')" class="bg-white p-3 rounded-2xl shadow-sm text-center active:scale-95 transition-transform">
                                <i class="fas fa-child text-green-600 text-xl mb-1 block"></i>
                                <span class="text-xs font-bold">æ‰¾é¤å»³</span>
                            </button>
                        </div>

                        ${toolsDB.drive.map(d => `
                            <div class="p-6 rounded-3xl glass-card ${d.color} border border-black/5 relative overflow-hidden">
                                <i class="fas fa-car absolute -right-2 -bottom-2 text-6xl opacity-10"></i>
                                <div class="text-xs font-bold opacity-60 mb-2 uppercase tracking-wider">${d.title}</div>
                                <div class="text-xl font-black leading-tight">${d.content}</div>
                            </div>
                        `).join('')}
                    </div>`;
            } else if (currentToolFilter === 'jp') {
                main.innerHTML = `
                    <div class="animate-slide-up space-y-8">
                        ${toolsDB.jp.map(cat => `
                            <div>
                                <h3 class="text-xs font-bold text-gray-400 uppercase mb-3 ml-2 tracking-wider border-l-2 border-blue-500 pl-2">${cat.label}</h3>
                                <div class="grid gap-3">
                                    ${cat.items.map(item => `
                                        <div class="glass-card p-5 rounded-3xl border border-slate-50 active:scale-[0.98] transition-transform">
                                            <div class="text-xs text-gray-500 mb-1 flex items-center gap-1"><i class="fas fa-language"></i> ${item.t}</div>
                                            <div class="text-xl font-black text-gray-800 mb-2">${item.j}</div>
                                            <div class="text-xs text-blue-500 font-bold bg-blue-50 inline-block px-2 py-1 rounded">${item.p}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>`;
            } else if (currentToolFilter === 'sos') {
                main.innerHTML = `
                    <div class="animate-slide-up space-y-3">
                        ${toolsDB.sos.map(s => `
                            <a href="tel:${s.tel}" class="${s.style} p-5 rounded-3xl shadow-lg flex items-center justify-between active:scale-95 transition-transform">
                                <div>
                                    <div class="text-sm opacity-80 font-medium mb-1">${s.name}</div>
                                    <div class="text-3xl font-black tracking-tighter">${s.tel}</div>
                                </div>
                                <div class="w-12 h-12 rounded-full bg-white/20 backdrop-blur flex items-center justify-center">
                                    <i class="fas fa-phone text-xl"></i>
                                </div>
                            </a>
                        `).join('')}
                    </div>`;
            }
        }
    }

    // =======================================================
    // æ ¸å¿ƒä¿®å¾©ï¼šå°ˆé–€ç”¨ä¾†åˆ‡æ›ä¸¦åŒæ­¥æ›´æ–°é¡è‰²çš„å‡½å¼
    // =======================================================

    // åˆ‡æ›æ¸…å–®
    window.switchChecklist = (id) => {
        currentChecklistFilter = id;
        renderContent(); 
        updateSubNavStyle(); // ç«‹åˆ»æ›´æ–°æŒ‰éˆ•é¡è‰²
    }

    // åˆ‡æ›å·¥å…·
    window.switchTool = (id) => {
        currentToolFilter = id;
        renderContent();
        updateSubNavStyle(); // ç«‹åˆ»æ›´æ–°æŒ‰éˆ•é¡è‰²
    }

    // æ›´æ–°æŒ‰éˆ•æ¨£å¼çš„æ ¸å¿ƒåŠŸèƒ½ (ç›´æ¥æ“ä½œ Classï¼Œä¸é‡ç¹ª HTML)
    function updateSubNavStyle() {
        if (activeTab === 'checklist') {
            checklistDB.forEach(c => {
                const btn = document.getElementById(`btn-chk-${c.id}`);
                if (btn) {
                    if (currentChecklistFilter === c.id) {
                        btn.className = "flex-1 py-2 rounded-xl text-xs font-bold transition-all bg-white text-blue-600 shadow-sm";
                    } else {
                        btn.className = "flex-1 py-2 rounded-xl text-xs font-bold transition-all text-white/80";
                    }
                }
            });
        } else if (activeTab === 'tools') {
            const tools = ['calc', 'drive', 'jp', 'sos'];
            tools.forEach(t => {
                const btn = document.getElementById(`btn-tool-${t}`);
                if (btn) {
                    // å®šç¾©ä¸åŒå·¥å…·çš„é¸å–é¡è‰²
                    let activeColor = "bg-white text-blue-600";
                    if(t === 'calc') activeColor = "bg-white text-yellow-600";
                    if(t === 'sos') activeColor = "bg-white text-red-600";
                    
                    if (currentToolFilter === t) {
                        btn.className = `flex-1 py-2 rounded-xl text-xs font-bold transition-all ${activeColor} shadow-sm`;
                        // åŒæ­¥åˆ‡æ›èƒŒæ™¯åœ–
                        document.getElementById('bg-layer').style.backgroundImage = `url('${t === 'calc' ? bgImages.CALC : bgImages.TOOL}')`;
                    } else {
                        btn.className = "flex-1 py-2 rounded-xl text-xs font-bold transition-all text-white/80";
                    }
                }
            });
        }
    }

    // äº’å‹•åŠŸèƒ½
    window.toggleCheck = (key) => {
        const val = localStorage.getItem(key);
        if (val === '1') localStorage.removeItem(key);
        else localStorage.setItem(key, '1');
    }
    
    window.resetChecklist = (id) => {
        if(confirm('é‡ç½®æ­¤æ¸…å–®ï¼Ÿ')) {
            const len = checklistDB.find(c => c.id === id).items.length;
            for(let i=0; i<len; i++) localStorage.removeItem(`chk_${id}_${i}`);
            renderContent();
        }
    }

    window.toggleMission = (id) => {
        const isDone = localStorage.getItem(id) === '1';
        if (isDone) {
            if(confirm('è¦å–æ¶ˆé€™å€‹æˆå°±å—ï¼Ÿ')) {
                localStorage.removeItem(id);
                renderContent();
            }
        } else {
            if(navigator.vibrate) navigator.vibrate(200);
            localStorage.setItem(id, '1');
            showToast("ğŸ‰ ä»»å‹™é”æˆï¼å¤ªæ£’äº†ï¼");
            renderContent();
        }
    }

    window.copyMapCode = (code) => {
        navigator.clipboard.writeText(code).then(() => {
            showToast("ğŸ”¢ MapCode å·²è¤‡è£½: " + code);
        });
    }

    // åŒ¯ç‡è¨ˆç®—åŠŸèƒ½ (è‡ªå‹•å„²å­˜)
    window.updateRate = (val) => {
        if(val && val > 0) {
            CURRENT_RATE = parseFloat(val);
            localStorage.setItem('user_rate', val); // å­˜å…¥ localStorage
            convertCurrency(); // ç«‹å³é‡æ–°è¨ˆç®—
        }
    }

    window.convertCurrency = () => {
        const jpyInput = document.getElementById('jpyInput');
        const twdOutput = document.getElementById('twdOutput');
        const jpy = parseFloat(jpyInput.value);
        
        if (isNaN(jpy) || jpy <= 0) {
            twdOutput.innerText = "0";
            return;
        }

        const twd = jpy * CURRENT_RATE;
        twdOutput.innerText = twd.toFixed(twd % 1 !== 0 ? 2 : 0).toLocaleString('en-US');
    }

    // Quick Search
    window.quickSearch = (query) => {
        const url = `https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(query)}&query_place_id=current_place`;
        window.open(url, '_system');
        showToast(`æ­£åœ¨æœå°‹é™„è¿‘çš„ã€Œ${query}ã€...`);
    }

    function showToast(msg) {
        const t = document.getElementById('toast');
        const m = document.getElementById('toast-msg');
        m.innerText = msg;
        t.className = "show";
        setTimeout(() => { t.className = ""; }, 3000);
    }

    init();
</script>
</body>
</html>
