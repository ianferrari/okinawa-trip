<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>å¥å¥å…¨å®¶æ²–ç¹©éŠ ğŸ¦•</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+TC:wght@400;500;700&display=swap" rel="stylesheet">
    <style>
        body { font-family: 'Noto Sans TC', sans-serif; background-color: #f3f4f6; -webkit-tap-highlight-color: transparent; }
        .hide-scrollbar::-webkit-scrollbar { display: none; }
        .hide-scrollbar { -ms-overflow-style: none; scrollbar-width: none; }
        /* æ¼¸å±¤èˆ‡é™°å½±è¨­è¨ˆ */
        .bg-gradient-brand { background: linear-gradient(135deg, #0ea5e9 0%, #3b82f6 100%); }
        .card-shadow { box-shadow: 0 4px 15px rgba(0,0,0,0.05); }
        .btn-active { transform: scale(0.98); opacity: 0.9; }
        /* Checkbox è‡ªè¨‚æ¨£å¼ */
        .custom-checkbox:checked + div { background-color: #3b82f6; border-color: #3b82f6; }
        .custom-checkbox:checked + div i { opacity: 1; }
    </style>
</head>
<body class="bg-gray-50 h-screen flex flex-col overflow-hidden text-gray-800">

    <div class="bg-gradient-brand text-white pt-safe-top pb-4 px-4 rounded-b-[2rem] shadow-lg z-20 flex-shrink-0 relative overflow-hidden">
        <i class="fas fa-plane absolute top-4 right-4 text-white/10 text-6xl"></i>
        
        <div class="pt-8 flex justify-between items-end relative z-10">
            <div>
                <p class="text-xs font-medium opacity-90 tracking-wider mb-1">2026 OKINAWA TRIP</p>
                <h1 class="text-2xl font-bold">å¥å¥å…¨å®¶æ²–ç¹©éŠ ğŸ¦•</h1>
                <p class="text-xs mt-1 opacity-90"><i class="fas fa-calendar-alt mr-1"></i>3/28 (å…­) - 4/3 (äº”) | å¥å¥ 3y</p>
            </div>
            <div class="bg-white/20 backdrop-blur-md px-3 py-2 rounded-xl text-center border border-white/10">
                <i class="fas fa-cloud-sun text-xl block mb-1"></i>
                <span class="text-xs font-bold">24Â°C</span>
            </div>
        </div>

        <div id="sub-nav-container" class="mt-4">
            </div>
    </div>

    <div id="main-scroll" class="flex-1 overflow-y-auto p-4 pb-28 space-y-4 scroll-smooth">
        </div>

    <div class="fixed bottom-0 w-full bg-white border-t border-gray-100 flex justify-around items-center pb-safe-bottom h-[85px] z-50 shadow-[0_-5px_20px_rgba(0,0,0,0.03)]">
        <button onclick="switchTab('itinerary')" class="nav-btn flex flex-col items-center justify-center w-full h-full group" id="btn-itinerary">
            <div class="icon-box p-1.5 rounded-xl mb-1 transition-all group-active:scale-95"><i class="fas fa-map-location-dot text-xl text-blue-600"></i></div>
            <span class="text-[10px] font-bold text-blue-600">è¡Œç¨‹</span>
        </button>
        <button onclick="switchTab('checklist')" class="nav-btn flex flex-col items-center justify-center w-full h-full group" id="btn-checklist">
            <div class="icon-box p-1.5 rounded-xl mb-1 transition-all group-active:scale-95"><i class="fas fa-clipboard-check text-xl text-gray-400"></i></div>
            <span class="text-[10px] font-bold text-gray-400">æ¸…å–®</span>
        </button>
        <button onclick="switchTab('tools')" class="nav-btn flex flex-col items-center justify-center w-full h-full group" id="btn-tools">
            <div class="icon-box p-1.5 rounded-xl mb-1 transition-all group-active:scale-95"><i class="fas fa-toolbox text-xl text-gray-400"></i></div>
            <span class="text-[10px] font-bold text-gray-400">å·¥å…·</span>
        </button>
    </div>

<script>
    // ==========================================
    // 1. è³‡æ–™åº« (Data Source) - ä¾†è‡ªæ‰€æœ‰ç¢ºèªæª”æ¡ˆ
    // ==========================================

    const itineraryDB = [
        {
            day: "D1", date: "3/28 (å…­)", title: "å•Ÿç¨‹ & é©æ‡‰",
            highlights: "æ©Ÿå ´è²·å¥¶ / OTSå–è»Š / ä½åè­·",
            events: [
                { time: "13:15", title: "æ˜Ÿå®‡ JX302 èµ·é£›", icon: "fa-plane-departure", note: "çµ¦å¥å¥åƒè»Ÿç³–å¹³è¡¡è€³å£“", map: "å°ä¸­åœ‹éš›æ©Ÿå ´" },
                { time: "15:45", title: "æŠµé”é‚£éœ¸æ©Ÿå ´", icon: "fa-plane-arrival", note: "1F Lawson è²·é®®å¥¶/æˆé•·å¥¶", map: "" },
                { time: "16:30", title: "æ­æ¥é§è»Šå¾€ OTS", icon: "fa-bus", note: "1F å¤§å»³å¤–æ‰¾ OTS æ——å¹Ÿ", map: "" },
                { time: "17:00", title: "OTS è‡¨ç©ºè±å´ å–è»Š", icon: "fa-car", note: "æª¢æŸ¥è»Šæ³ã€è£æ±½åº§ã€‚å°èˆªè¨­é£¯åº—", map: "OTS è‡¨ç©ºè±å´ç‡Ÿæ¥­æ‰€" },
                { time: "18:00", title: "é«˜é€Ÿå…¬è·¯åŒ—ä¸Š", icon: "fa-road", note: "ä¸­é€”åœï¼šä¸­åŸ PA æˆ– ä¼ŠèŠ¸ SA", map: "" },
                { time: "19:30", title: "é£¯åº— Check-in", icon: "fa-hotel", note: "Best Western Kouki Beach", map: "Best Western Okinawa Kouki Beach" },
                { time: "20:00", title: "æ™šé¤ï¼šåè­·åœ¨åœ°", icon: "fa-utensils", note: "ç¾æ‹‰èŠ±åˆ¥é‚¸ / å“¥å€«å¸ƒç‰›æ’ / å…¨å®¶", map: "Restaurant Columbin" }
            ]
        },
        {
            day: "D2", date: "3/29 (æ—¥)", title: "ç»ç’ƒèˆ¹ & è£œçµ¦",
            highlights: "æµ·ä¸­å…¬åœ’ / AEON æƒè²¨ / ç©æ²™",
            events: [
                { time: "09:30", title: "éƒ¨ç€¨åæµ·ä¸­å…¬åœ’", icon: "fa-water", note: "æ­ç»ç’ƒåº•èˆ¹æ‰¾å°¼è« ğŸ ", map: "éƒ¨ç€¨åæµ·ä¸­å…¬åœ’" },
                { time: "12:00", title: "åˆé¤ï¼šHama å£½å¸", icon: "fa-bowl-rice", note: "åè­·åº—ï¼Œå¹³åƒ¹è¿´è½‰å£½å¸", map: "HAMAå£½å¸ åè­·åº—" },
                { time: "13:30", title: "AEON åè­·åº—", icon: "fa-cart-shopping", note: "å¤§å‰µè²·ç©æ²™çµ„ã€è¶…å¸‚è²·æ°´", map: "AEON åè­·åº—" },
                { time: "15:00", title: "è¨±ç”°ä¼‘æ¯ç«™", icon: "fa-ticket", note: "è²·æ°´æ—é¤¨å„ªæƒ ç¥¨ (åªæ”¶ç¾é‡‘)", map: "é“ã®é§… è¨±ç”°" },
                { time: "16:00", title: "é£¯åº—æ²™ç˜ç©æ²™", icon: "fa-umbrella-beach", note: "æ‹¿å‡ºå¤§å‰µè²·çš„ç©å…·", map: "" },
                { time: "18:00", title: "æ™šé¤ï¼šç¾æ‹‰èŠ±åˆ¥é‚¸", icon: "fa-utensils", note: "èµ°è·¯å»åƒï¼Œæ¦»æ¦»ç±³åŒ…å»‚", map: "ç¾æ‹‰èŠ±" }
            ]
        },
        {
            day: "D3", date: "3/30 (ä¸€)", title: "ç¾éº—æµ· & å¤å®‡åˆ©",
            highlights: "é¯¨é¯Š / è·¨æµ·å¤§æ©‹ / è¦è¦é£¯",
            events: [
                { time: "09:30", title: "ç¾éº—æµ·æ°´æ—é¤¨", icon: "fa-fish", note: "åœ P7 ç«‹é«”åœè»Šå ´æœ€å¿«ï¼Œç›´è¡é»‘æ½®ä¹‹æµ·", map: "æµ·æ´‹åšå…¬åœ’P7ç«‹é«”åœè»Šå ´" },
                { time: "13:30", title: "å‰å¾€å¤å®‡åˆ©å³¶", icon: "fa-car-side", note: "è»Šä¸Šè®“å¥å¥åˆç¡", map: "" },
                { time: "14:30", title: "å¤å®‡åˆ©æµ·æ´‹å¡”", icon: "fa-tower-observation", note: "æ­ç„¡äººé³³æ¢¨è»Š", map: "å¤å®‡åˆ©æµ·æ´‹å¡”" },
                { time: "16:00", title: "é»å¿ƒï¼šè¦è¦é£¯", icon: "fa-shrimp", note: "Kouri Shrimp (æ©‹æ—)", map: "Kouri Shrimp" },
                { time: "16:30", title: "æ©‹ä¸‹æ²™ç˜", icon: "fa-camera", note: "æ‹å…¨å®¶ç¦", map: "å¤å®‡åˆ©æµ·ç˜" },
                { time: "18:00", title: "æ™šé¤ï¼šåè­·ä¸ƒé¸ä¸€", icon: "fa-fire-burner", note: "å¤§å®¶ / ç‡’è‚‰ä¹ƒæˆ‘é‚£éœ¸ / è—å£½å¸", map: "ç‡’è‚‰ä¹ƒæˆ‘é‚£éœ¸ æ–°é¤¨" }
            ]
        },
        {
            day: "D4", date: "3/31 (äºŒ)", title: "æé¾ & å…¬åœ’",
            highlights: "DINO Park / ç”œç”œåœˆ / æºœæ»‘æ¢¯",
            events: [
                { time: "10:00", title: "DINO æé¾ PARK", icon: "fa-dragon", note: "âš ï¸ çˆ¸çˆ¸è«‹ç”¨æ¹å·¾ï¼Œæ¨è»Šé›£è¡Œ", map: "DINOæé¾PARK å±±åŸäºç†±å¸¶ä¹‹æ£®" },
                { time: "11:30", title: "åˆé¤ï¼šå¾¡è“å­å¾¡æ®¿", icon: "fa-bowl-food", note: "å°±åœ¨æé¾å…¬åœ’æ¨“ä¸Š", map: "" },
                { time: "13:00", title: "å³¶è±†è…ç”œç”œåœˆ", icon: "fa-cookie-bite", note: "Shima Donuts (è‹¥è³£å®Œåƒ A&W)", map: "Shima Donuts" },
                { time: "15:00", title: "21ä¸–ç´€ä¹‹æ£®å…¬åœ’", icon: "fa-child-reaching", note: "çœ‹é»‘è‰²ç«è»Šé ­ã€æºœæ»‘æ¢¯", map: "21ä¸–ç´€ä¹‹æ£®å…¬åœ’" },
                { time: "16:30", title: "Blue Seal å†°æ·‡æ·‹", icon: "fa-ice-cream", note: "åè­·åº—ï¼Œåƒ Kids Size", map: "Blue Seal Nago" }
            ]
        },
        {
            day: "D5", date: "4/01 (ä¸‰)", title: "å‹•ç‰© & æ”¾ç©º",
            highlights: "Neo Park å°ç«è»Š / é£¯åº—æ³³æ± ",
            events: [
                { time: "10:00", title: "Neo Park å‹•æ¤ç‰©åœ’", icon: "fa-crow", note: "é€²é–€å…ˆæ­å¾©å¤å°ç«è»Š", map: "åè­·è‡ªç„¶å‹•æ¤ç‰©å…¬åœ’" },
                { time: "12:30", title: "åˆé¤ï¼šCookhal", icon: "fa-leaf", note: "æˆ–åƒ å¹¸é†¬æ²–ç¹©éºµ (æ¦»æ¦»ç±³)", map: "Cookhal" },
                { time: "15:30", title: "é£¯åº—æ³³æ± /æ²™ç˜", icon: "fa-person-swimming", note: "å¤§äººæ”¾ç©ºï¼Œå°å­©å¾¹åº•æ”¾é›»", map: "" },
                { time: "18:00", title: "æ™šé¤ï¼šç™¾å¹´å¤å®¶ å¤§å®¶", icon: "fa-house", note: "å¿…åƒé˜¿å¤è±¬ç«é‹ (å·²é ç´„)", map: "ç™¾å¹´å¤å®¶ å¤§å®¶" },
                { time: "20:00", title: "æ‰“åŒ…è¡Œæ", icon: "fa-suitcase", note: "æ˜å¤©è¦é€€æˆ¿å¾€å—äº†", map: "" }
            ]
        },
        {
            day: "D6", date: "4/02 (å››)", title: "ç§»å‹• & è³¼ç‰©",
            highlights: "PARCO CITY / DMM / ä½é‚£éœ¸",
            events: [
                { time: "10:30", title: "é€€æˆ¿å¾€å—", icon: "fa-car", note: "ç›´å¥”æµ¦æ·» (ç´„1å°æ™‚)", map: "" },
                { time: "11:30", title: "PARCO CITY", icon: "fa-bag-shopping", note: "åˆé¤(2Fç¾é£Ÿè¡—) & è³¼ç‰© & ç©å…·åæ–—åŸ", map: "SAN-A æµ¦æ·»è¥¿æµ·å²¸ PARCO CITY" },
                { time: "15:00", title: "DMM æ°´æ—é¤¨", icon: "fa-fish-fins", note: "ä½æ–¼ iias å•†å ´ï¼Œçœ‹æ¨¹æ‡¶ã€æ‘¸é­š", map: "DMM Kariyushi Aquarium" },
                { time: "17:40", title: "é‚£éœ¸ Check-in", icon: "fa-building", note: "Daiwa Roynet åœ‹éš›é€š (è»Šåœ3F)", map: "Daiwa Roynet Hotel Naha Kokusai-dori" },
                { time: "19:00", title: "æ™šé¤ï¼šåœ‹éš›é€š", icon: "fa-utensils", note: "HAN'S ç‰›æ’ / Chinuman å±…é…’å±‹", map: "JUMBO STEAK HAN'S åœ‹é™…é€šç‰§å¿—åº—" },
                { time: "20:30", title: "Fontana Gelato", icon: "fa-ice-cream", note: "å½©è™¹å†°æ·‡æ·‹", map: "Fontana Gelato" }
            ]
        },
        {
            day: "D7", date: "4/03 (äº”)", title: "ç¥ˆé¡˜ & è¿”å®¶",
            highlights: "æ³¢ä¸Šå®® / Outlet / 13:00é‚„è»Š",
            events: [
                { time: "09:20", title: "æ³¢ä¸Šå®®", icon: "fa-torii-gate", note: "æ‡¸å´–ä¸Šçš„ç¥ç¤¾ï¼Œè²·å¾¡å®ˆ", map: "æ³¢ä¸Šå®®" },
                { time: "11:10", title: "ASHIBINAA Outlet", icon: "fa-shirt", note: "åˆé¤(ç¾é£Ÿè¡—) & æœ€å¾Œè¡åˆº", map: "ASHIBINAA Outlet" },
                { time: "12:40", title: "åŠ æ²¹ (OTSæ—)", icon: "fa-gas-pump", note: "ä¿ç•™æ”¶æ“šï¼", map: "ENEOS Dr.Drive Self Toyosaki SS" },
                { time: "13:00", title: "OTS é‚„è»Š", icon: "fa-car-side", note: "å‹™å¿…æº–æ™‚ã€‚æª¢æŸ¥ ETC å¡æ‹”äº†æ²’", map: "OTS è‡¨ç©ºè±å´ç‡Ÿæ¥­æ‰€" },
                { time: "13:45", title: "æŠµé”æ©Ÿå ´", icon: "fa-plane-departure", note: "é€›å…ç¨…åº—", map: "é‚£éœ¸æ©Ÿå ´" },
                { time: "16:45", title: "æ˜Ÿå®‡ JX303 èµ·é£›", icon: "fa-paper-plane", note: "å›å®¶å›‰ï¼", map: "" }
            ]
        }
    ];

    const checklistDB = [
        { 
            id: "pack", title: "ğŸ’ è¡Œå‰æ‰“åŒ… (P1/P2)", items: [
            { text: "è­·ç…§ (å…¨å®¶3æœ¬)", sub: "æ•ˆæœŸéœ€ > 2026/10" },
            { text: "é§•ç…§æ­£æœ¬ + æ—¥æ–‡è­¯æœ¬", sub: "OTS å–è»Šå¿…å‚™" },
            { text: "Visit Japan Web æˆªåœ–", sub: "å­˜æ‰‹æ©Ÿç›¸ç°¿" },
            { text: "å¥å¥å®‰æ’«åŒ…", sub: "è²¼ç´™æ›¸ã€è»Ÿç³–ã€è–„å¤–å¥—" },
            { text: "è»Šå…§ç™¾å¯¶è¢‹", sub: "é®é™½ç°¾ã€è»Šå……ã€åƒåœ¾è¢‹" },
            { text: "è¡Œå‹•é›»æº (éš¨èº«)", sub: "ä¸å¯æ‰˜é‹" },
            { text: "é£Ÿç‰©å‰ªåˆ€ (æ‰˜é‹)", sub: "ä¸å¯éš¨èº«" }
        ]},
        { 
            id: "shop", title: "ğŸ›ï¸ è³¼ç‰©å¿…è²· (P6)", items: [
            { text: "åˆåˆ©ä»–å‘½ EX Plus", sub: "å®¶åº­å¸¸å‚™" },
            { text: "è‹¥å…ƒéŒ  (Wakamoto)", sub: "é¡§è…¸èƒƒ" },
            { text: "EVE æ­¢ç—›è—¥", sub: "è—è‰²/ç™½è‰²" },
            { text: "Kowa èšŠèŸ²æ­¢ç™¢æ¶²", sub: "åˆ·é ­ç‰ˆ" },
            { text: "å¤§å‰µ - æé¾æ³¡æ¾¡çƒ", sub: "AEON åè­·åº—" },
            { text: "å¤§å‰µ - æŒ–æ²™å·¥å…·çµ„", sub: "æµ·é‚Šç©æ²™ç”¨" },
            { text: "LuLuLun é¢è†œ", sub: "æ²–ç¹©é™å®šå£å‘³" },
            { text: "Tomica æ²–ç¹©é™å®šè»Š", sub: "PARCO / æ©Ÿå ´" }
        ]},
        {
            id: "return", title: "ğŸš¨ å›ç¨‹é˜²å‘† (P2)", items: [
            { text: "ETC å¡æ‹”äº†å—ï¼Ÿ", sub: "é‚„è»Šå‰ç¢ºèª" },
            { text: "è»Šå……é ­æ‹”äº†å—ï¼Ÿ", sub: "é‚„è»Šå‰ç¢ºèª" },
            { text: "æ²¹åŠ æ»¿äº†å—ï¼Ÿ", sub: "ä¿ç•™æ”¶æ“š" },
            { text: "å¸ƒä¸/æœå‡ æ‰˜é‹äº†å—ï¼Ÿ", sub: "æ¶²é«” > 100ml" },
            { text: "è­·ç…§æ‹¿å‡ºä¾†äº†å—ï¼Ÿ", sub: "ä¸è¦é–åœ¨é£¯åº—ä¿éšªç®±" }
        ] }
    ];

    const toolsDB = {
        drive: [
            { title: "å³é§•å£è¨£", content: "å·¦è½‰å°å½ã€å³è½‰å¤§å½<br>é›¨åˆ·åœ¨å·¦ã€æ–¹å‘ç‡ˆåœ¨å³", color: "bg-blue-50 text-blue-800" },
            { title: "åŠ æ²¹é‡‘å¥", content: "Regular æ»¿æ²¹ (ç´…æ§)<br>ãƒ¬ã‚®ãƒ¥ãƒ©ãƒ¼æº€ã‚¿ãƒ³<br>(Regyuraa mantan)", color: "bg-red-50 text-red-800" },
            { title: "åœè»Šå ´", content: "é§è»Šå ´ (Chuu-sha-joo)<br>ğŸ…¿ï¸ æ‰¾ P å­—æ¨™èªŒ", color: "bg-gray-100 text-gray-800" }
        ],
        jp: [
            { label: "é¤å»³", items: [
                { t: "ä¸è¦åŠ å†°å¡Š", j: "æ°·ãªã—ã§ãŠé¡˜ã„ã—ã¾ã™", p: "Koori nashi de" },
                { t: "æœ‰å…’ç«¥æ¤…å—?", j: "å­ä¾›ç”¨ã®æ¤…å­ã¯ã‚ã‚Šã¾ã™ã‹?", p: "Kodomo-yo no isu..." },
                { t: "çµ¦å…’ç«¥é¤å…·", j: "å­ä¾›ç”¨ã®å–ã‚Šçš¿ã¨ã‚¹ãƒ—ãƒ¼ãƒ³", p: "Torizara to supuun" }
            ]},
            { label: "è³¼ç‰©", items: [
                { t: "æˆ‘è¦æ‰¾é€™å€‹", j: "ã“ã‚Œã¨åŒã˜ã‚‚ã®ã‚’æ¢ã—ã¦ã„ã¾ã™", p: "Kore to onaji mono..." },
                { t: "æˆ‘è¦é€€ç¨…", j: "å…ç¨ã‚’ãŠé¡˜ã„ã—ã¾ã™", p: "Menzei o onegai..." },
                { t: "ä¸è¦å°èµ·ä¾†(é¦¬ä¸Šç”¨)", j: "è¢‹ã«å…¥ã‚Œãªã„ã§ãã ã•ã„", p: "Fukuro ni irenaide" }
            ]},
            { label: "æ€¥ç”¨", items: [
                { t: "å°å­©ç™¼ç‡’äº†", j: "å­ä¾›ãŒç†±ã‚’å‡ºã—ã¾ã—ãŸ", p: "Kodomo ga netsu o..." },
                { t: "è«‹å«æ•‘è­·è»Š", j: "æ•‘æ€¥è»Šã‚’å‘¼ã‚“ã§ãã ã•ã„", p: "Kyukyu-sha o yonde" }
            ]}
        ],
        sos: [
            { name: "æ•‘è­·è»Š / ç«è­¦", tel: "119", style: "bg-red-500 text-white" },
            { name: "å ±è­¦ (è»Šç¦)", tel: "110", style: "bg-blue-600 text-white" },
            { name: "OTS ç§Ÿè»Šæ•‘æ´", tel: "098-856-8877", style: "bg-green-600 text-white" },
            { name: "å¤–äº¤éƒ¨æ€¥é›£æ•‘åŠ©", tel: "080-8056-0122", style: "bg-gray-700 text-white" },
            { name: "åè­·åŒ—éƒ¨é†«é™¢", tel: "0980-52-2719", style: "bg-white border text-gray-800" },
            { name: "é‚£éœ¸å—éƒ¨é†«ç™‚", tel: "098-888-0123", style: "bg-white border text-gray-800" }
        ]
    };

    // ==========================================
    // 2. æ ¸å¿ƒé‚è¼¯ (Core Logic)
    // ==========================================
    
    let activeTab = 'itinerary';
    let currentDayIdx = 0;
    let currentChecklistFilter = 'pack';
    let currentToolFilter = 'drive';

    function init() {
        renderHeaderSubNav();
        renderContent();
    }

    // åˆ‡æ›åº•éƒ¨ Tab
    window.switchTab = (tab) => {
        activeTab = tab;
        // æ›´æ–°æŒ‰éˆ•æ¨£å¼
        document.querySelectorAll('.nav-btn').forEach(btn => {
            const icon = btn.querySelector('i');
            const span = btn.querySelector('span');
            const box = btn.querySelector('.icon-box');
            
            if(btn.id === `btn-${tab}`) {
                icon.className = icon.className.replace('text-gray-400', 'text-blue-600');
                span.className = 'text-[10px] font-bold text-blue-600';
                box.className = 'icon-box p-1.5 rounded-xl mb-1 transition-all bg-blue-50';
            } else {
                icon.className = `fas fa-${btn.id.split('-')[1] === 'itinerary' ? 'map-location-dot' : btn.id.split('-')[1] === 'checklist' ? 'clipboard-check' : 'toolbox'} text-xl text-gray-400`;
                span.className = 'text-[10px] font-bold text-gray-400';
                box.className = 'icon-box p-1.5 rounded-xl mb-1 transition-all';
            }
        });
        renderHeaderSubNav();
        renderContent();
    }

    // æ¸²æŸ“é ‚éƒ¨æ¬¡å°èˆª
    function renderHeaderSubNav() {
        const container = document.getElementById('sub-nav-container');
        if (activeTab === 'itinerary') {
            container.innerHTML = `
                <div class="flex overflow-x-auto gap-3 pb-2 hide-scrollbar">
                    ${itineraryDB.map((d, i) => `
                        <button onclick="currentDayIdx=${i}; renderContent(); updateHeaderActive()" 
                            class="day-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold border border-white/20 transition-all ${i === currentDayIdx ? 'bg-white text-blue-600 shadow-md scale-105' : 'bg-white/20 text-white'}">
                            <div class="text-[10px] opacity-80">${d.day}</div>
                            <div>${d.date.split(' ')[0]}</div>
                        </button>
                    `).join('')}
                </div>`;
        } else if (activeTab === 'checklist') {
            container.innerHTML = `
                <div class="flex bg-white/20 p-1 rounded-xl backdrop-blur-sm">
                    ${checklistDB.map(c => `
                        <button onclick="currentChecklistFilter='${c.id}'; renderContent();" 
                            class="flex-1 py-1.5 rounded-lg text-xs font-bold transition-all ${currentChecklistFilter === c.id ? 'bg-white text-blue-600 shadow-sm' : 'text-white/80'}">
                            ${c.title.split(' ')[1]}
                        </button>
                    `).join('')}
                </div>`;
        } else if (activeTab === 'tools') {
            container.innerHTML = `
                <div class="flex bg-white/20 p-1 rounded-xl backdrop-blur-sm">
                    <button onclick="currentToolFilter='drive'; renderContent()" class="flex-1 py-1.5 rounded-lg text-xs font-bold ${currentToolFilter==='drive'?'bg-white text-blue-600':'text-white/80'}">ğŸš— é§•é§›</button>
                    <button onclick="currentToolFilter='jp'; renderContent()" class="flex-1 py-1.5 rounded-lg text-xs font-bold ${currentToolFilter==='jp'?'bg-white text-blue-600':'text-white/80'}">ğŸ—£ï¸ æ—¥èª</button>
                    <button onclick="currentToolFilter='sos'; renderContent()" class="flex-1 py-1.5 rounded-lg text-xs font-bold ${currentToolFilter==='sos'?'bg-white text-red-600':'text-white/80'}">ğŸš¨ æ€¥é›£</button>
                </div>`;
        }
    }

    function updateHeaderActive() {
        const btns = document.querySelectorAll('.day-btn');
        btns.forEach((btn, i) => {
            btn.className = `day-btn flex-shrink-0 px-4 py-2 rounded-xl text-sm font-bold border border-white/20 transition-all ${i === currentDayIdx ? 'bg-white text-blue-600 shadow-md scale-105' : 'bg-white/20 text-white'}`;
        });
    }

    // æ¸²æŸ“ä¸»è¦å…§å®¹
    function renderContent() {
        const main = document.getElementById('main-scroll');
        
        // 1. è¡Œç¨‹å…§å®¹
        if (activeTab === 'itinerary') {
            const d = itineraryDB[currentDayIdx];
            main.innerHTML = `
                <div class="fade-in">
                    <div class="bg-white rounded-2xl p-4 card-shadow mb-4 border-l-4 border-blue-500">
                        <div class="flex justify-between items-start">
                            <div>
                                <h2 class="text-xl font-bold text-gray-800">${d.date}</h2>
                                <p class="text-sm text-gray-500 mt-1">${d.title}</p>
                            </div>
                            <span class="bg-blue-100 text-blue-700 text-[10px] font-bold px-2 py-1 rounded-full">Day ${currentDayIdx + 1}</span>
                        </div>
                        <div class="mt-3 text-xs bg-gray-50 p-2 rounded-lg text-gray-600">
                            <i class="fas fa-highlighter text-yellow-500 mr-1"></i> ${d.highlights}
                        </div>
                    </div>
                    
                    <div class="space-y-3">
                        ${d.events.map((e, idx) => `
                            <div class="bg-white p-3 rounded-2xl card-shadow flex gap-3 relative overflow-hidden">
                                ${idx !== d.events.length - 1 ? '<div class="absolute left-[27px] top-[40px] bottom-[-20px] w-0.5 bg-gray-100 z-0"></div>' : ''}
                                <div class="z-10 flex flex-col items-center">
                                    <div class="w-10 h-10 rounded-full bg-blue-50 text-blue-500 flex items-center justify-center shadow-sm">
                                        <i class="fas ${e.icon}"></i>
                                    </div>
                                </div>
                                <div class="flex-1 min-w-0">
                                    <div class="flex justify-between items-start">
                                        <h3 class="font-bold text-gray-800 text-lg leading-tight">${e.time}</h3>
                                        ${e.map ? `<a href="https://www.google.com/maps/search/?api=1&query=${encodeURIComponent(e.map)}" target="_blank" class="bg-blue-50 text-blue-600 p-1.5 rounded-lg text-xs active:scale-90 transition-transform"><i class="fas fa-location-arrow mr-1"></i>å°èˆª</a>` : ''}
                                    </div>
                                    <div class="font-bold text-gray-700 mt-0.5">${e.title}</div>
                                    ${e.note ? `<div class="text-xs text-gray-500 mt-1 bg-gray-50 p-1.5 rounded inline-block"><i class="fas fa-info-circle mr-1 text-blue-400"></i>${e.note}</div>` : ''}
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="h-8"></div>
                </div>`;
        } 
        
        // 2. æ¸…å–®å…§å®¹
        else if (activeTab === 'checklist') {
            const list = checklistDB.find(c => c.id === currentChecklistFilter);
            main.innerHTML = `
                <div class="fade-in bg-white rounded-2xl p-5 card-shadow">
                    <h3 class="font-bold text-lg mb-4 flex items-center gap-2">
                        <i class="fas fa-list-ul text-blue-500"></i> ${list.title}
                    </h3>
                    <div class="space-y-3">
                        ${list.items.map((item, i) => {
                            const key = `chk_${currentChecklistFilter}_${i}`;
                            const isChecked = localStorage.getItem(key) === '1';
                            return `
                                <label class="flex items-start gap-3 p-2 rounded-xl active:bg-gray-50 cursor-pointer select-none">
                                    <div class="relative flex items-center mt-1">
                                        <input type="checkbox" class="custom-checkbox peer appearance-none w-5 h-5 border-2 border-gray-300 rounded-md transition-all" 
                                            ${isChecked ? 'checked' : ''} onchange="toggleCheck('${key}')">
                                        <div class="absolute inset-0 flex items-center justify-center pointer-events-none transition-colors rounded-md">
                                            <i class="fas fa-check text-white text-xs opacity-0 transition-opacity"></i>
                                        </div>
                                    </div>
                                    <div class="flex-1">
                                        <div class="font-bold text-gray-700 peer-checked:text-gray-400 peer-checked:line-through transition-colors">${item.text}</div>
                                        ${item.sub ? `<div class="text-xs text-gray-500 peer-checked:text-gray-300">${item.sub}</div>` : ''}
                                    </div>
                                </label>
                            `;
                        }).join('')}
                    </div>
                    <button onclick="resetChecklist('${currentChecklistFilter}')" class="w-full mt-6 py-3 text-center text-xs text-gray-400 hover:text-gray-600">
                        <i class="fas fa-rotate-right mr-1"></i> é‡ç½®æ­¤æ¸…å–®
                    </button>
                </div>`;
        }

        // 3. å·¥å…·å…§å®¹
        else if (activeTab === 'tools') {
            if (currentToolFilter === 'drive') {
                main.innerHTML = `
                    <div class="space-y-4 fade-in">
                        ${toolsDB.drive.map(d => `
                            <div class="p-5 rounded-2xl card-shadow ${d.color} border border-black/5">
                                <div class="text-sm font-bold opacity-70 mb-1">${d.title}</div>
                                <div class="text-xl font-bold leading-relaxed">${d.content}</div>
                            </div>
                        `).join('')}
                    </div>`;
            } else if (currentToolFilter === 'jp') {
                main.innerHTML = `
                    <div class="space-y-6 fade-in">
                        ${toolsDB.jp.map(cat => `
                            <div>
                                <h3 class="text-xs font-bold text-gray-400 uppercase mb-2 ml-1 tracking-wider">${cat.label}</h3>
                                <div class="space-y-3">
                                    ${cat.items.map(item => `
                                        <div class="bg-white p-4 rounded-2xl card-shadow border border-gray-100">
                                            <div class="text-xs text-gray-500 mb-1">${item.t}</div>
                                            <div class="text-2xl font-bold text-gray-800 mb-1">${item.j}</div>
                                            <div class="text-xs text-blue-500">${item.p}</div>
                                        </div>
                                    `).join('')}
                                </div>
                            </div>
                        `).join('')}
                    </div>`;
            } else if (currentToolFilter === 'sos') {
                main.innerHTML = `
                    <div class="space-y-3 fade-in">
                        ${toolsDB.sos.map(s => `
                            <a href="tel:${s.tel}" class="${s.style} p-4 rounded-2xl card-shadow flex items-center justify-between active:scale-95 transition-transform">
                                <div>
                                    <div class="text-sm opacity-90">${s.name}</div>
                                    <div class="text-2xl font-bold tracking-wider">${s.tel}</div>
                                </div>
                                <div class="w-10 h-10 rounded-full bg-white/20 flex items-center justify-center">
                                    <i class="fas fa-phone"></i>
                                </div>
                            </a>
                        `).join('')}
                    </div>`;
            }
        }
    }

    // Checkbox ç‹€æ…‹åˆ‡æ›
    window.toggleCheck = (key) => {
        const val = localStorage.getItem(key);
        if (val === '1') localStorage.removeItem(key);
        else localStorage.setItem(key, '1');
    }

    window.resetChecklist = (id) => {
        if(confirm('ç¢ºå®šè¦é‡ç½®é€™å€‹æ¸…å–®å—ï¼Ÿ')) {
            // æ¸…é™¤è©²åˆ†é¡ä¸‹çš„æ‰€æœ‰ localStorage key
            const len = checklistDB.find(c => c.id === id).items.length;
            for(let i=0; i<len; i++) localStorage.removeItem(`chk_${id}_${i}`);
            renderContent();
        }
    }

    // å•Ÿå‹•
    init();

    // ç°¡å–®æ·¡å…¥å‹•ç•«
    const style = document.createElement('style');
    style.innerHTML = `.fade-in { animation: fadeIn 0.3s ease-out; } @keyframes fadeIn { from { opacity: 0; transform: translateY(5px); } to { opacity: 1; transform: translateY(0); } }`;
    document.head.appendChild(style);

</script>
</body>
</html>
